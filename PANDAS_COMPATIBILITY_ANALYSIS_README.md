# Pandas å…¼å®¹æ€§åˆ†æé¡¹ç›®

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ç³»ç»Ÿæ€§åœ°åˆ†æäº† DataStore ä¸ Pandas çš„å…¼å®¹æ€§ï¼Œé€šè¿‡æ”¶é›† GitHub ä¸Šæœ€å—æ¬¢è¿çš„ Jupyter Notebook ä¸­çš„çœŸå® pandas æ“ä½œï¼Œå¹¶é€šè¿‡ `import datastore as pd` çš„æ–¹å¼è¿›è¡Œ monkey patch æµ‹è¯•ï¼Œå‘ç°å¹¶è®°å½•äº†å…¼å®¹æ€§é—®é¢˜å’Œæ”¹è¿›å»ºè®®ã€‚

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®æ”¶é›†

**åˆ†æäº† 15 ä¸ªçƒ­é—¨ Jupyter Notebook æ–‡ä»¶**ï¼Œæ¥è‡ªä»¥ä¸‹ä»“åº“ï¼š
- `donnemartin/data-science-ipython-notebooks` (6 ä¸ªæ–‡ä»¶)
- `jvns/pandas-cookbook` (7 ä¸ªæ–‡ä»¶)
- `KeithGalli/complete-pandas-tutorial` (1 ä¸ªæ–‡ä»¶)
- `LearnDataSci/articles` (1 ä¸ªæ–‡ä»¶)

**æå–äº† 331 ä¸ªçœŸå®çš„ pandas æ“ä½œç¤ºä¾‹**ï¼Œåˆ†ä¸º 10 ä¸ªç±»åˆ«ï¼š
1. æ•°æ®é€‰æ‹© - 207 ä¸ªç¤ºä¾‹
2. DataFrame åˆ›å»º - 26 ä¸ªç¤ºä¾‹
3. æ•°æ®æ¸…æ´— - 24 ä¸ªç¤ºä¾‹
4. ç»Ÿè®¡æ“ä½œ - 24 ä¸ªç¤ºä¾‹
5. æ•°æ®è½¬æ¢ - 17 ä¸ªç¤ºä¾‹
6. æ’åº - 12 ä¸ªç¤ºä¾‹
7. èšåˆæ“ä½œ - 6 ä¸ªç¤ºä¾‹
8. å­—ç¬¦ä¸²æ“ä½œ - 6 ä¸ªç¤ºä¾‹
9. åˆå¹¶æ“ä½œ - 5 ä¸ªç¤ºä¾‹
10. æ—¶é—´åºåˆ—æ“ä½œ - 4 ä¸ªç¤ºä¾‹

### 2. å…¼å®¹æ€§æµ‹è¯•

åˆ›å»ºäº†å…¨é¢çš„æµ‹è¯•è„šæœ¬ `pandas_compatibility_test.py`ï¼Œå¯¹ 44 ä¸ªæ ¸å¿ƒæ“ä½œè¿›è¡Œäº†å¯¹æ¯”æµ‹è¯•ï¼š

**æµ‹è¯•ç»“æœ**:
- âœ… Pandas æˆåŠŸç‡: 43/44 (97.7%)
- âœ… DataStore æˆåŠŸç‡: 40/44 (90.9%)
- âš ï¸ ç»“æœåŒ¹é…ç‡: 18/40 (45.0%)

### 3. é—®é¢˜åˆ†æ

è¯†åˆ«å‡ºä¸‰ç±»ä¸»è¦é—®é¢˜ï¼š

#### ğŸ”´ å…³é”®å…¼å®¹æ€§é—®é¢˜ (4 ä¸ª)
1. **å¸ƒå°”ç´¢å¼•ä¸æ”¯æŒ**: `df[df['age'] > 30]`
2. **GroupBy.size() ä¸å¯ç”¨**: `df.groupby('col').size()`
3. **å­—ç¬¦ä¸²æ“ä½œå‚æ•°ä¸å…¼å®¹**: `str.contains(pattern, na=False)`
4. **DateTime ç±»å‹è½¬æ¢é—®é¢˜**: to_datetime æœªçœŸæ­£è½¬æ¢ç±»å‹

#### ğŸŸ¡ ç»“æœå·®å¼‚é—®é¢˜ (22 ä¸ª)
- æ‰€æœ‰æ’åºæ“ä½œç»“æœä¸ä¸€è‡´
- æ‰€æœ‰æ•°æ®æ¸…æ´—æ“ä½œç»“æœä¸ä¸€è‡´
- æ‰€æœ‰å­—ç¬¦ä¸²æ“ä½œç»“æœä¸ä¸€è‡´
- æ‰€æœ‰æ—¥æœŸæ—¶é—´æ“ä½œç»“æœä¸ä¸€è‡´
- éƒ¨åˆ†å…¶ä»–æ“ä½œï¼ˆåˆ‡ç‰‡ã€é‡å‘½åã€èšåˆç­‰ï¼‰

#### ğŸŸ¢ å·²å…¼å®¹æ“ä½œ (18 ä¸ª)
- DataFrame åˆ›å»º
- åŸºæœ¬æ•°æ®é€‰æ‹©ï¼ˆåˆ—é€‰æ‹©ã€locã€ilocï¼‰
- ç»Ÿè®¡æ–¹æ³•ï¼ˆmeanã€sumã€medianã€stdã€corrï¼‰
- éƒ¨åˆ†èšåˆæ“ä½œ
- åˆå¹¶æ“ä½œï¼ˆconcatã€mergeï¼‰

## ğŸ“ é¡¹ç›®æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

1. **`pandas_compatibility_test.py`** (580 è¡Œ)
   - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
   - å¯¹æ¯” pandas å’Œ datastore çš„è¡Œä¸º
   - ç”Ÿæˆè¯¦ç»†çš„å…¼å®¹æ€§æŠ¥å‘Š

2. **`PANDAS_COMPATIBILITY_IMPROVEMENT_RECOMMENDATIONS.md`** (è¯¦ç»†æŠ¥å‘Š)
   - æ‰§è¡Œæ‘˜è¦
   - æŒ‰ä¼˜å…ˆçº§åˆ†ç±»çš„æ”¹è¿›å»ºè®®
   - å®ç°è·¯çº¿å›¾
   - æŠ€æœ¯æ·±åº¦åˆ†æ

3. **`pandas_operations_analysis.json`** (20 KB)
   - 331 ä¸ª pandas æ“ä½œç¤ºä¾‹
   - æŒ‰ç±»åˆ«ç»„ç»‡
   - åŒ…å«å®é™…ä»£ç å’Œæ“ä½œç±»å‹

4. **`pandas_compatibility_report.txt`**
   - äººç±»å¯è¯»çš„æµ‹è¯•æŠ¥å‘Š
   - è¯¦ç»†çš„æµ‹è¯•ç»“æœ
   - æŒ‰ç±»åˆ«ç»„ç»‡çš„å…¼å®¹æ€§çŠ¶æ€

5. **`pandas_compatibility_results.json`**
   - æœºå™¨å¯è¯»çš„è¯¦ç»†æµ‹è¯•ç»“æœ
   - åŒ…å«æ¯ä¸ªæµ‹è¯•çš„æˆåŠŸ/å¤±è´¥çŠ¶æ€
   - åŒ…å«é”™è¯¯ä¿¡æ¯å’Œæ³¨é‡Š

6. **`downloaded_notebooks/`** (ç›®å½•)
   - 15 ä¸ªåŸå§‹ Jupyter Notebook æ–‡ä»¶
   - ç”¨äºéªŒè¯å’Œå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå…¼å®¹æ€§æµ‹è¯•

```bash
# ç¡®ä¿å·²å®‰è£…ä¾èµ–
pip install pandas numpy 'chdb>=4.0.0b2'

# è¿è¡Œæµ‹è¯•
python pandas_compatibility_test.py

# æŸ¥çœ‹æŠ¥å‘Š
cat pandas_compatibility_report.txt
```

### æŸ¥çœ‹åˆ†ææ•°æ®

```python
import json

# åŠ è½½ pandas æ“ä½œåˆ†æ
with open('pandas_operations_analysis.json') as f:
    operations = json.load(f)

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
print(f"åˆ†æçš„ notebook æ•°é‡: {operations['metadata']['num_notebooks_analyzed']}")
print(f"æ“ä½œç±»å‹æ•°é‡: {operations['metadata']['total_operation_types']}")
print(f"æ€»ç¤ºä¾‹æ•°: {operations['metadata']['total_unique_examples']}")

# æŸ¥çœ‹æŸä¸ªç±»åˆ«çš„ç¤ºä¾‹
for example in operations['detailed_operations']['data_selection']['examples'][:5]:
    print(example['code'])
```

## ğŸ“Š å…³é”®å‘ç°

### ä¼˜åŠ¿é¢†åŸŸ

DataStore åœ¨ä»¥ä¸‹æ–¹é¢è¡¨ç°è‰¯å¥½ï¼š
- âœ… **DataFrame åˆ›å»º**: 100% å…¼å®¹
- âœ… **åŸºç¡€ç»Ÿè®¡**: mean, sum, median, std å®Œå…¨åŒ¹é…
- âœ… **æ•°æ®åˆå¹¶**: concat, merge å·¥ä½œæ­£å¸¸
- âœ… **åŸºç¡€é€‰æ‹©**: åˆ—é€‰æ‹©ã€locã€iloc æ”¯æŒè‰¯å¥½

### éœ€è¦æ”¹è¿›çš„é¢†åŸŸ

1. **æ•°æ®è¿‡æ»¤** (é«˜ä¼˜å…ˆçº§)
   - ä¸æ”¯æŒå¸ƒå°”ç´¢å¼• `df[condition]`
   - å½±å“å¤§é‡å®é™…ç”¨ä¾‹

2. **æ“ä½œç»“æœä¸€è‡´æ€§** (é«˜ä¼˜å…ˆçº§)
   - æ’åºã€æ¸…æ´—ã€å­—ç¬¦ä¸²æ“ä½œè™½ç„¶èƒ½æ‰§è¡Œï¼Œä½†ç»“æœä¸ pandas ä¸åŒ
   - å¯èƒ½æ˜¯è¿”å›ç±»å‹ã€ç´¢å¼•å¤„ç†æˆ–æ ¼å¼åŒ–é—®é¢˜

3. **GroupBy åŠŸèƒ½** (ä¸­ä¼˜å…ˆçº§)
   - size() æ–¹æ³•ç¼ºå¤±
   - å¤šåˆ—èšåˆæ ¼å¼ä¸ä¸€è‡´

4. **DateTime æ”¯æŒ** (ä¸­ä¼˜å…ˆçº§)
   - ç±»å‹è½¬æ¢æœªçœŸæ­£æ‰§è¡Œ
   - dt accessor æ— æ³•æ­£å¸¸å·¥ä½œ

## ğŸ› ï¸ æ¨èçš„ä¿®å¤ä¼˜å…ˆçº§

### Phase 1: å…³é”®ä¿®å¤ (ç«‹å³)
```
1. å®ç°å¸ƒå°”ç´¢å¼•æ”¯æŒ
2. æ·»åŠ  GroupBy.size() æ–¹æ³•
3. ä¿®å¤å­—ç¬¦ä¸²æ“ä½œçš„å‚æ•°ç­¾å
4. ä¿®å¤ to_datetime çš„ç±»å‹è½¬æ¢
```

### Phase 2: ç»“æœä¸€è‡´æ€§ (1-2 å‘¨)
```
1. ä¿®å¤æ‰€æœ‰æ’åºæ“ä½œçš„è¾“å‡ºæ ¼å¼
2. ç»Ÿä¸€æ•°æ®æ¸…æ´—æ“ä½œçš„è¿”å›ç±»å‹
3. ä¿®å¤å­—ç¬¦ä¸²æ“ä½œçš„ Series è¿”å›
4. ç¡®ä¿ç´¢å¼•åœ¨æ‰€æœ‰æ“ä½œä¸­æ­£ç¡®ä¼ é€’
```

### Phase 3: åŠŸèƒ½å®Œå–„ (2-4 å‘¨)
```
1. å¢å¼º apply/map/lambda æ”¯æŒ
2. å®Œå–„ GroupBy èšåˆåŠŸèƒ½
3. å®ç°æ›´å¤šç»Ÿè®¡æ–¹æ³•
4. æ”¹è¿› IO åŠŸèƒ½
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡çŸ©é˜µ

| æ“ä½œç±»åˆ« | æµ‹è¯•æ•° | æˆåŠŸ | åŒ¹é… | è¦†ç›–ç‡ |
|---------|-------|------|------|-------|
| DataFrame åˆ›å»º | 2 | 2 | 2 | 100% âœ… |
| æ•°æ®é€‰æ‹© | 6 | 5 | 4 | 67% âš ï¸ |
| æ•°æ®æ¸…æ´— | 5 | 5 | 0 | 0% ğŸ”´ |
| ç»Ÿè®¡æ“ä½œ | 7 | 7 | 6 | 86% âœ… |
| æ•°æ®è½¬æ¢ | 5 | 4 | 2 | 40% âš ï¸ |
| æ’åº | 4 | 4 | 0 | 0% ğŸ”´ |
| èšåˆæ“ä½œ | 4 | 3 | 2 | 50% âš ï¸ |
| å­—ç¬¦ä¸²æ“ä½œ | 5 | 4 | 0 | 0% ğŸ”´ |
| åˆå¹¶æ“ä½œ | 2 | 2 | 2 | 100% âœ… |
| DateTime æ“ä½œ | 4 | 4 | 0 | 0% ğŸ”´ |

## ğŸ” æ·±åº¦åˆ†æäº®ç‚¹

### å‘ç° 1: å¸ƒå°”ç´¢å¼•æ˜¯æœ€å¸¸ç”¨çš„è¿‡æ»¤æ–¹å¼

åœ¨ 207 ä¸ªæ•°æ®é€‰æ‹©ç¤ºä¾‹ä¸­ï¼Œå¸ƒå°”ç´¢å¼•å æ®äº†å¾ˆå¤§æ¯”ä¾‹ã€‚è¿™æ˜¯ pandas ç”¨æˆ·çš„æ ¸å¿ƒä¹ æƒ¯ï¼Œä¸æ”¯æŒä¼šä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒã€‚

**ç¤ºä¾‹**:
```python
df[df['age'] > 30]
df[(df['age'] > 30) & (df['salary'] > 50000)]
df[df['name'].str.contains('Alice')]
```

### å‘ç° 2: ç»“æœä¸åŒ¹é…å¯èƒ½æ˜¯ç±»å‹é—®é¢˜

è®¸å¤šæ“ä½œèƒ½æ‰§è¡ŒæˆåŠŸï¼Œä½†ç»“æœä¸åŒ¹é…ã€‚æ·±å…¥åˆ†æå‘ç°å¯èƒ½æ˜¯ï¼š
- è¿”å› `LazyOps` å¯¹è±¡è€Œé `DataFrame`
- ç´¢å¼•è¢«é‡ç½®è€Œéä¿ç•™
- åˆ—é¡ºåºå‘ç”Ÿå˜åŒ–

**å»ºè®®**: å®ç°ç»Ÿä¸€çš„ç»“æœåŒ…è£…å™¨ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œè¿”å› pandas å…¼å®¹çš„å¯¹è±¡ã€‚

### å‘ç° 3: DateTime æ“ä½œå¤±è´¥çš„æ ¹æœ¬åŸå› 

é”™è¯¯æ—¥å¿—æ˜¾ç¤ºï¼š
```
Illegal type String of argument of function toYear
```

è¯´æ˜ `to_datetime()` æ²¡æœ‰çœŸæ­£è½¬æ¢ ClickHouse å†…éƒ¨çš„åˆ—ç±»å‹ï¼Œä»ç„¶æ˜¯ Stringã€‚

**å»ºè®®**: åœ¨ `to_datetime` ä¸­ä½¿ç”¨ ClickHouse çš„ç±»å‹è½¬æ¢å‡½æ•°ï¼Œå¦‚ `parseDateTimeBestEffort()`ã€‚

## ğŸ“š ç›¸å…³èµ„æº

### å‚è€ƒçš„ Notebook ä»“åº“

1. [donnemartin/data-science-ipython-notebooks](https://github.com/donnemartin/data-science-ipython-notebooks)
   - â­ 27k+ stars
   - å…¨é¢çš„æ•°æ®ç§‘å­¦ notebook é›†åˆ

2. [jvns/pandas-cookbook](https://github.com/jvns/pandas-cookbook)
   - â­ 6.5k+ stars
   - å®ç”¨çš„ pandas æ•™ç¨‹

3. [KeithGalli/complete-pandas-tutorial](https://github.com/KeithGalli/complete-pandas-tutorial)
   - â­ 1k+ stars
   - å®Œæ•´çš„ pandas æ•™ç¨‹

4. [LearnDataSci/articles](https://github.com/LearnDataSci/articles)
   - é«˜è´¨é‡çš„æ•°æ®ç§‘å­¦æ•™ç¨‹

### Pandas æ–‡æ¡£

- [Pandas API Reference](https://pandas.pydata.org/docs/reference/index.html)
- [Pandas User Guide](https://pandas.pydata.org/docs/user_guide/index.html)

## ğŸ¤ è´¡çŒ®

æœ¬åˆ†æä¸º DataStore çš„ pandas å…¼å®¹æ€§æ”¹è¿›æä¾›äº†æ•°æ®æ”¯æŒã€‚å»ºè®®ï¼š

1. **åˆ›å»º Issue**: ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ 1 çš„é—®é¢˜åˆ›å»º GitHub Issue
2. **å®ç°ä¿®å¤**: æŒ‰ç…§æ¨èçš„ Phase 1-3 è·¯çº¿å›¾å®æ–½
3. **æ·»åŠ æµ‹è¯•**: å°† `pandas_compatibility_test.py` é›†æˆåˆ° CI/CD
4. **æ›´æ–°æ–‡æ¡£**: åˆ›å»ºå…¼å®¹æ€§çŸ©é˜µå’Œè¿ç§»æŒ‡å—

## ğŸ“ è®¸å¯

æœ¬åˆ†æé¡¹ç›®éµå¾ª DataStore é¡¹ç›®çš„è®¸å¯åè®®ã€‚

---

**ç”Ÿæˆæ—¶é—´**: 2025-12-20
**DataStore ç‰ˆæœ¬**: master branch
**chdb ç‰ˆæœ¬**: 4.0.0b2
**åˆ†æçš„ Notebook æ•°é‡**: 15
**æå–çš„æ“ä½œç¤ºä¾‹**: 331
**æ‰§è¡Œçš„æµ‹è¯•**: 44
